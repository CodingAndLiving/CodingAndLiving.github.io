---
layout:     post
title:      solr，我来了
subtitle:   Lucene学习系列
date:       2019-07-07
author:     CodingAndLiving
header-img: img/com01.jpg
catalog: true
tags:
    - solr
    - 全文索引
    - 搜索引擎
---
# 前言

> **Lucene学习系列**主要介绍了Lucene、solr和ES三者的特点，**本文**主要介绍了solr的原理。


# solr是什么
首先，solr是一个提供全文搜索的服务。但是，为了全面了解solr，我们得利用比较方法，即回答下面两个问题。

1. solr和Lucene的区别

	首先，Lucene仅仅是一个jar包，也就是说，里面定义了方法和类，但是你得自己结合代码进行开发。而solr不是jar包，
	是一个服务，只需要搭建起来，就可以提供搜索服务。当然，solr也是在Lucene的基础上封装而来。

2. solr和ElaticSearche的区别

	ES也是基于Lucene的一个提供全文搜索的服务，同样也是搭建起来，即可使用。那它和solr的区别是什么？
	
	个人看法：

	- solr适合于数据量不大的，并且提前准备好索引的搜索。
	- ES适合于实时创建索引，并且马上可以搜素的情况。
	- 当然，其实solr和ES都可以支持分布式。

# solr的个别特点
#### solr的安装和部署
solr首先本身自带了jetty服务器启动，另外，也支持使用tomcat部署。

#### solrHome和solrCore路径
solrHome是solr服务的主目录，solrCore路径可以理解为提供搜素和索引的服务单元，每一个solrCore都可以提供单独的索引和搜素服务。

#### solr配置文件中的标签

1. field标签

	field标签，就是指Lucene中域，该标签有属性name、type、indexed、stored、multivalued属性。

2. fieldType标签
	
	该标签，就是对应field的type属性，可用于分词。

3. copyfield标签

	该标签，一般用于提升搜素效率。例如将多个field复制到一个field中，那么搜素范围就减少了。

4. dynamic Field标签

	该标签，顾名思义就是动态标签，动态是指name属性以通配符的形式存在。

# solrCloud
#### solrCloud是什么？
solrCloud是solr的分布式升级版，具备分布式、高可用和分片的特点。

#### 什么时候需要采用solrCloud，而不是solr？
满足一下两个条件：

- 搜索和索引的数据量大。

- 需要分布式、高可用和切片的功能。


#### solrCloud结构图

![avatar](data:image/png;base64,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o48+GldeeWU0NTXFu971rvjTP/3TeOyxxwq6lwCDJ/QCw0Z7vTjr1q2Lzs7OOPzww3fatn79+sjzPCZNmtTr8kMPPTQ2bdrUMwYRERMnTuz5ecOGDZHnecycOTNqtVrUarX467/+69i6dWu0t7cP352pU+Z/OoxlGpzeAAwb7fXivPvd746IiDVr1sQRRxzRa9uBBx4YEREvv/xyHHnkkT2Xr127NpqamqJS+d16SJZlPT+PHz8+IiKWLFkSBx100LDVngrzPx3GksJVq9W8Wq3m7Kz7sSl6jLoZq/4VPVbDNTZbtmzJjznmmPzpp5/eadurr76a12q1fMWKFb0uf/jhh/NPfOITeZ7n+cqVK/NqtZo/++yzPds3bdqU12q1/Lnnnuu57PHHH88//vGPD3n9eT4yYzOcx8YXvvCFfObMmflzzz2Xd3R05M8++2y+du3aPM/z/LLLLsvPO++8/Pnnn887OjryVatW5X/0R3+Uf//738/z/HeP/9atW3td54UXXpj/7d/+bb5hw4a8o6Mjf+655/Lly5cPS/31/Pib/yPPWPav3sZyuFjp7UdXV1d85zvfiYceeig2btwY73nPe+KWW26J3//934/29va455574tFHH41///d/j/e85z1x1llnxZ//+Z9HpVKJVatWxezZs2Pu3Llx6623xmmnnRaXXnppbN++PW699db4wQ9+EO3t7XHCCSfE1VdfHWPHji367tY1Y1VOw91ef7v29vbYe++9h/Ae1L/58+fHN77xjbjoooti69atcdhhh8X8+fMjIuKGG26I22+/PS6++OLYvHlzTJw4MWbPnh0zZswY8Dq/8pWvxE033RQzZsyI9vb2mDRpUlxyySUjcXfqivmfDmOZDqG3H1oZ9cNYlZP2evHGjBkTV111VVx11VU7bdt3333j0ksvjUsvvbTPvz3qqKOipaVlp8vHjx8fX/3qV4e81tSY/+kwlunwRrY+eNdz/TBW5dXU1BQnnHBCzJ8/P55//vno7OyM5557LtatWxcTJkyIk046KebPnx8vvPBCdHZ2xs9//vO48847Y9asWQNeZ7VajQULFsTGjRujs7Mznn/++XjqqadG8J7Brpn/6TCW6bDS2wetjPphrMpNe51GZv6nw1imQejtg1ZG/TBW5aa9TiMz/9NhLNPg9IY+aGXUD2MFAAyG0NuP+fPn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e+650dbWVnRJDaH7dWXx4sVxyimnxCc/+cl46qmn4r777ovp06fHySefHD/5yU969neqSX3wXFZuHu0S0b4qxpo1a+Kss86K7du37/F1aWHtvsG21zs6OuK+++6Lc845Z4QrTN+pp54aixcvjilTpsTll19edDkNZfXq1fEP//APceyxx8Y111wTL7/8cixZsiSmTZsWX/va17IBtzIAABpBSURBVIouj93guaz8hN4S+eY3v9nrX4aMjNdeey3WrFkzJNd1wQUXxLnnnhvjxo2L8ePHxwUXXBCrVq3yj5gB7NheHzNmTL/t9S9/+ctRqVTiz/7sz0a4wrStX78+VqxYEVmWxSGHHBLbt2+PPM+LLqth/Mmf/EmMGTMmTjvttNi0aVPMnj07xowZE5/85Cfj3/7t36Kzs7PoEhkkz2XlJ/S+TX+tiR099dRTcf7558eUKVPijDPOiCeffDIiIv7qr/4qrr/++l77XnTRRXHzzTdHRMT27dvjq1/9akyfPj2OP/74uPrqq+P111/v2Vf7ame72wLsb2wi+h/b7nPkpk6dGrVarefygcaru65FixbFiSee2HN9Wli7bzDt9a9//evR1tYWt956a4wePbqAKtPV2dkZN9xwQ3zsYx+L+++/P+bNmxdZlkVERK1W2+n42PEYYc+9613vioiIMWPGRETEhAkTIiJin332iYgQeuuI57Ly80q8g8G2JrZu3RrXXntt/Ou//mtMmzYtvvzlL0dExJlnnhlLly6N9vb2iIj4zW9+E08//XScffbZERExb968ePbZZ+P++++PRx55JF599dW45ZZbRubO1bnBtgD7G5uBxvbee++NiIgnn3wyWlpaei4fzHgtX748Fi9eHHPmzNmpZi2swRuovX777bfH448/HnfffXeMHz++oArTNXHixHjooYdi+fLl8dBDD8XHP/7xnm0tLS19/gf0zXNZuQm9Oxhsa2L69OkxadKkePHFF2Ps2LGxbt266OjoiGnTpkVE9Kwu/vCHP4yjjjoqPvCBD8Srr74ajz76aFx55ZXR1NQU73rXu+JP//RP47HHHhupu1fXBtsC7G9sBju23QY7XrNmzYr9998/xo4du9N1aGENzkDt9bvuuiuWLVsW99xzT88KGEAZeS4rPx9ZtoPu1sQ3vvGN+N73vhdXXXVVNDc377TfbbfdFosWLYrJ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)

说明：
	
- 首先solrCloud集群，下面有三台solr服务器。（额外的zk没有画出）

- 每台solr服务器下面有两个solrCore，每个core都可以提供单独的索引和搜索服务。

- 三台服务器都拿出一个core，组成分片。例如分片1的三个core分别位于三台服务器的core。

- 两个分片组成了一个collection。

- 不同的分片，体现了分布式计算，

- 同一个分片的不同core，体现了负载均衡、冗余备份和高可用。

#### solrCloud索引流程

1. 客户端发来的信息，会找到任意一个分片的任意一个core。

2. 如果该core不是master，会交给master处理。

3. 如果master发现，该数据不属于自己分片的，会交给对应分片的master处理。

4. master将该消息，自身和同一个分片的所有slave都会存储。


#### solrCloud搜索流程

1. 客户端发来的消息，回到任意的一个core中。

2. core会根据切片的个数，将消息分为多个子消息，交给不同分片的任意一个core进行查询。

3. 汇总消息，并且返回客户端。

4. 注意，这里搜索，不强调master，任意一个core都可以。


#### solrCloud分片扩容的流程

1. 首先旧的分片，会提供原来的服务。

2. 旧的分片上的master，会将旧的文档，根据新的路由规则，路由到不太的分片的leader中进行索引。

3. 新的索引文档，也是跟第二部一样。

4. 分片扩容完成后，旧的分片服务会切换新分片的路由服务。











