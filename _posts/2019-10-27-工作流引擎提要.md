---
layout:     post
title:      工作流引擎提要
subtitle:   工作流引擎提要
date:       2019-10-27
author:     CodingAndLiving
header-img: img/com01.jpg
catalog: true
tags:
    - 工作流引擎
    - activiti
    - 提要
---
# 前言

> **本文**主要记载了关于工作流引擎activiti的部分知识。

备注：基于Activiti5版本

# 部署流程定义

涉及的表

	act_re_deployment：部署对象表
	act_re_procdef：流程定义表
	act_ge_bytearray：资源文件表
	act_ge_property：主键生成策略表

说明：

1. 每当部署一次流程定义文件，就会在部署对象表发生一次记录，流程定义表也是一条记录，资源文件表两条记录，分别表示bpmn和png文件。

# 流程的执行

涉及的表

	act_ru_execution： 正在执行的执行对象表
	act_hi_procinst：流程实例的历史表
	act_hi_actinst：活动节点历史表
	act_ru_task：正在执行的任务信息
	act_hi_taskinst：已经执行完的历史任务信息

说明：

1. 每当启动这个流程，就会产生一个流程实例。一个流程的开始到结束整一个生命周期中，有且仅有一个流程实例。
2. 执行对象，不等同于流程实例。如果流程存在分支，则执行对象可以存在多个。
3. 一般，执行对象和任务数量关系是1：1。
4. 活动节点表表示流程从开始到结束的过程中经历的所有结点。
5. 任务表，一般存储流程图组件为UserTask之类的记录。


# 流程变量

涉及的表


	act_ru_variable：正在执行的流程变量表
	act_hi_varinst：流程变量历史表


说明：

1. API的setVariable：设置流程变量的时候，流程变量名称相同的时候，后一次的值替换前一次的值，而且可以看到TASK_ID的字段不会存放任务ID的值
2. API的setVariableLocal：
	1. 设置流程变量的时候，针对当前活动的节点设置流程变量，如果一个流程中存在2个活动节点，对每个活动节点都设置流程变量，即使流程变量的名称相同，
		后一次的版本的值也不会替换前一次版本的值，它会使用不同的任务ID作为标识，存放2个流程变量值，而且可以看到TASK_ID的字段会存放任务ID的值
		例如act_hi_varinst 表的数据：不同的任务节点，即使流程变量名称相同，存放的值也是不同的。
	2. 还有，使用setVariableLocal说明流程变量绑定了当前的任务，当流程继续执行时，下个任务获取不到这个流程变量（因为正在执行的流程变量中没有这个数据），
		所有查询正在执行的任务时不能查询到我们需要的数据，此时需要查询历史的流程变量。



# 为什么运行数据和历史数据会分开存放

由于数据库中保存着历史信息以及正在运行的流程实例信息，在实际项目中对已完成任务的查看频率远不及对代办和可接任务的查看，所以在activiti采用分开管理，
把正在运行的交给RuntimeService、TaskService管理，而历史数据交给HistoryService来管理。
这样做的好处在于，加快流程执行的速度，因为正在执行的流程的表中数据不会很大。


# 个人任务和组任务

涉及的表

	act_ru_identitylink表存放任务的办理人，包括个人任务和组任务，表示正在执行的任务
	act_hi_identitylink表存放任务的办理人，包括个人任务和组任务，表示历史任务
	区别在于：如果是个人任务TYPE的类型表示participant（参与者）
			 如果是组任务TYPE的类型表示candidate（候选者）和participant（参与者）

说明：

1. 一般个人任务，或者指定了参与者的组任务，都会在任务表的办理人字段里面标识了任务的参与者。



