---
layout:     post
title:      CPU100%排查
subtitle:   Bug处理系列
date:       2019-07-27
author:     CodingAndLiving
header-img: img/com01.jpg
catalog: true
tags:
    - cpu100%使用率
    - 排查问题
---
# 前言

> **Bug处理系列**主要介绍了线上常见问题的排查方法，**本文**主要介绍了当CPU使用率达到100时候的排查方法


# 情景

有时候，我们会发现程序在用户使用时候，非常卡顿，压根无法进行操作，连界面都打不开。这时候，我们会先想到是不是网络问题，
例如，ping一下服务器的Ip，发现没问题，那么，接下来，就需要服务器的资源使用问题了，例如查看下进程的情况，发现了cpu
使用100了，那么这时候，我们如何操作呢？

# 思路

1. 首先，我们得知道JAVA程序，不管cpu使用到100，最后都是得定位到，程序哪行代码出了问题。那么，我们如何根据服务器的进程，
定位到哪行代码呢？

# 步骤

- 首先，利用linux系统的top命令，找到cpu消耗最高的进程，这里顺便推荐下htop命令，可以理解为top的升级版，个人感觉使用不错。

- 接着，根据进程，找到对应的线程，参考命令如下

> top -H -p pid

> 查看指定进程中每个线程的资源占用情况(每条线程占用CPU时间的百分比)

- 根据上面的结果，找出cpu最高的线程Id，得注意的是，这里查看到的线程Id，是十进制显示的

- 接着呢，我们需要查看线程的堆栈信息，参考命令

> jstack pid(进程Id) > 文件目录

> jstack 17499 > ./threadDump.log

- 这里需要注意的是，我们上面的命令，是将堆栈信息输出到文件，这是好的，因为输出文件完毕后，可以立刻重启程序，再来分析原因。

- 接着，我们将第三步骤找到的线程id，来搜索堆栈文件里面的信息，就可以知道是哪一个文件的哪一行代码了。不过由于堆栈文件里面的线程id
是十六进制，而第三步骤查询出来的线程id是十进制，所以得先转化为十六进制。

- 到了这里，知道哪行代码出现问题了，作为程序员的你，还不会处理么？




